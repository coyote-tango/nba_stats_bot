import praw
import time
from selenium import webdriver
from bs4 import BeautifulSoup
import requests
import difflib
import re
import pprint

# # for a in soup.select(".players-list__names a"):
# # 	players_dict[(a.text.lower().replace(',', ''))] = a['href'].strip('player/')

players_dict = {'abrines, alex': '203518', 'acy, quincy': '203112', 'adams, steven': '203500', 'adebayo, bam': '1628389', 'afflalo, arron': '201167', 'ajinca, alexis': '201582', 'aldrich, cole': '202332', 'aldridge, lamarcus': '200746', 'allen, jarrett': '1628386', 'allen, kadeem': '1628443', 'allen, tony': '2754', 'aminu, al-farouq': '202329', 'anderson, justin': '1626147', 'anderson, kyle': '203937', 'anderson, ryan': '201583', 'anigbogu, ike': '1628387', 'antetokounmpo, giannis': '203507', 'anthony, carmelo': '2546', 'anunoby, og': '1628384', 'arcidiacono, ryan': '1627853', 'ariza, trevor': '2772', 'arthur, darrell': '201589', 'artis, jamel': '1628503', 'asik, omer': '201600', 'augustin, d.j.': '201571', 'babbitt, luke': '202337', 'bacon, dwayne': '1628407', 'baker, ron': '1627758', 'baldwin iv, wade': '1627735', 'ball, lonzo': '1628366', 'barea, j.j.': '200826', 'barnes, harrison': '203084', 'barton, will': '203115', 'batum, nicolas': '201587', 'bayless, jerryd': '201573', 'baynes, aron': '203382', 'bazemore, kent': '203145', 'beal, bradley': '203078', 'beasley, malik': '1627736', 'beasley, michael': '201563', 'belinelli, marco': '201158', 'bell, jordan': '1628395', "bembry, deandre'": '1627761', 'bender, dragan': '1627733', 'bertans, davis': '202722', 'beverley, patrick': '201976', 'birch, khem': '203920', 'bird, jabari': '1628444', 'biyombo, bismack': '202687', 'bjelica, nemanja': '202357', 'black, tarik': '204028', 'blakeney, antonio': '1628469', 'bledsoe, eric': '202339', 'blue, vander': '203505', 'bogdanovic, bogdan': '203992', 'bogdanovic, bojan': '202711', 'bogut, andrew': '101106', 'bolomboy, joel': '1627762', 'booker, devin': '1626164', 'booker, trevor': '202344', 'boucher, chris': '1628449', 'bradley, avery': '202340', 'bradley, tony': '1628396', 'brewer, corey': '201147', 'brogdon, malcolm': '1627763', 'brooks, aaron': '201166', 'brooks, dillon': '1628415', 'brown, anthony': '1626148', 'brown, bobby': '201628', 'brown, jaylen': '1627759', 'brown, lorenzo': '203485', 'brown, sterling': '1628425', 'brussino, nicolas': '1627852', 'bryant, thomas': '1628418', 'bullock, reggie': '203493', 'burks, alec': '202692', 'butler, jimmy': '202710', 'buycks, dwight': '202779', 'caboclo, bruno': '203998', 'calderon, jose': '101181', 'caldwell-pope, kentavious': '203484', 'capela, clint': '203991', 'carroll, demarre': '201960', 'carter, vince': '1713', 'carter-williams, michael': '203487', 'caruso, alex': '1627936', 'casspi, omri': '201956', 'cauley-stein, willie': '1626161', 'chalmers, mario': '201596', 'chandler, tyson': '2199', 'chandler, wilson': '201163', 'chriss, marquese': '1627737', 'clark, ian': '203546', 'clarkson, jordan': '203903', 'clavell, gian': '1628492', 'collins, john': '1628381', 'collins, zach': '1628380', 'collison, darren': '201954', 'collison, nick': '2555', 'conley, mike': '201144', 'connaughton, pat': '1626192', 'cook, quinn': '1626188', 'cooke, charles': '1628429', 'cooley, jack': '204022', 'costello, matt': '1627856', 'cousins, demarcus': '202326', 'covington, robert': '203496', 'crabbe, allen': '203459', 'craig, torrey': '1628470', 'crawford, jamal': '2037', 'crowder, jae': '203109', 'cunningham, dante': '201967', 'curry, seth': '203552', 'curry, stephen': '201939', 'daniels, troy': '203584', 'davis, anthony': '203076', 'davis, deyonta': '1627738', 'davis, ed': '202334', 'derozan, demar': '201942', 'dedmon, dewayne': '203473', 'dekker, sam': '1626155', 'delaney, malcolm': '1627098', 'dellavedova, matthew': '203521', 'deng, luol': '2736', 'diallo, cheick': '1627767', 'dieng, gorgui': '203476', 'dinwiddie, spencer': '203915', 'dorsey, tyler': '1628416', 'dotson, damyean': '1628422', 'dozier, pj': '1628408', 'dragic, goran': '201609', 'drummond, andre': '203083', 'dudley, jared': '201162', 'dunn, kris': '1627739', 'durant, kevin': '201142', 'ellenson, henry': '1627740', 'ellington, wayne': '201961', 'embiid, joel': '203954', 'ennis, tyler': '203898', 'ennis iii, james': '203516', 'evans, jawun': '1628393', 'evans, tyreke': '201936', 'exum, dante': '203957', 'faried, kenneth': '202702', 'favors, derrick': '202324', 'felder, kay': '1627770', 'felicio, cristiano': '1626245', 'felix, carrick': '203467', 'felton, raymond': '101109', 'ferguson, terrance': '1628390', 'ferrell, yogi': '1627812', 'finney-smith, dorian': '1627827', 'forbes, bryn': '1627854', 'fournier, evan': '203095', "fox, de'aaron": '1628368', 'frazier, tim': '204025', 'frye, channing': '101112', 'fultz, markelle': '1628365', 'gallinari, danilo': '201568', 'galloway, langston': '204038', 'gasol, marc': '201188', 'gasol, pau': '2200', 'gay, rudy': '200752', 'george, paul': '202331', 'georges-hunt, marcus': '1627875', 'gibson, taj': '201959', 'giles, harry': '1628385', 'ginobili, manu': '1938', 'gobert, rudy': '203497', 'gordon, aaron': '203932', 'gordon, eric': '201569', 'gortat, marcin': '101162', 'graham, treveon': '1626203', 'grant, jerami': '203924', 'grant, jerian': '1626170', 'green, danny': '201980', 'green, draymond': '203110', 'green, jamychal': '203210', 'green, jeff': '201145', 'griffin, blake': '201933', 'griffin, eric': '203547', 'hamilton, daniel': '1627772', 'hammons, aj': '1627773', 'hardaway jr., tim': '203501', 'harden, james': '201935', 'harkless, maurice': '203090', 'harrell, montrezl': '1626149', 'harris, devin': '2734', 'harris, gary': '203914', 'harris, joe': '203925', 'harris, tobias': '202699', 'harrison, andrew': '1626150', 'hart, josh': '1628404', 'haslem, udonis': '2617', 'hayward, gordon': '202330', 'henson, john': '203089', 'hernangomez, juan': '1627823', 'hernangomez, willy': '1626195', 'hezonja, mario': '1626209', 'hicks, isaiah': '1628439', 'hield, buddy': '1627741', 'hill, george': '201588', 'hill, solomon': '203524', 'hilliard, darrun': '1626199', 'holiday, jrue': '201950', 'holiday, justin': '203200', 'holland, john': '204066', 'hollis-jefferson, rondae': '1626178', 'holmes, richaun': '1626158', 'hood, rodney': '203918', 'horford, al': '201143', 'howard, dwight': '2730', 'huestis, josh': '203962', 'hunter, vincent': '1626205', 'ibaka, serge': '201586', 'iguodala, andre': '2738', 'ilyasova, ersan': '101141', 'ingles, joe': '204060', 'ingram, brandon': '1627742', 'irving, kyrie': '202681', 'isaac, jonathan': '1628371', 'iwundu, wes': '1628411', 'jack, jarrett': '101127', 'jackson, demetrius': '1627743', 'jackson, frank': '1628402', 'jackson, josh': '1628367', 'jackson, justin': '1628382', 'jackson, reggie': '202704', 'james, lebron': '2544', 'james, mike': '1628455', 'jefferson, al': '2744', 'jefferson, richard': '2210', 'jerebko, jonas': '201973', 'johnson, amir': '101161', 'johnson, brice': '1627744', 'johnson, dakari': '1626177', 'johnson, james': '201949', 'johnson, joe': '2207', 'johnson, stanley': '1626169', 'johnson, tyler': '204020', 'johnson, wesley': '202325', 'jokic, nikola': '203999', 'jones, damian': '1627745', 'jones, jalen': '1627883', 'jones, tyus': '1626145', 'jones jr., derrick': '1627884', 'jordan, deandre': '201599', 'joseph, cory': '202709', 'kaminsky, frank': '1626163', 'kanter, enes': '202683', 'kennard, luke': '1628379', 'kidd-gilchrist, michael': '203077', 'kilpatrick, sean': '203930', 'kleber, maxi': '1628467', 'knight, brandon': '202688', 'korkmaz, furkan': '1627788', 'kornet, luke': '1628436', 'korver, kyle': '2594', 'koufos, kosta': '201585', 'kuzma, kyle': '1628398', 'kuzminskas, mindaugas': '1627851', 'lavine, zach': '203897', 'labissiere, skal': '1627746', 'lamb, jeremy': '203087', 'larkin, shane': '203499', 'lauvergne, joffrey': '203530', 'layman, jake': '1627774', 'levert, caris': '1627747', 'leaf, tj': '1628388', 'lee, courtney': '201584', 'len, alex': '203458', 'leonard, kawhi': '202695', 'leonard, meyers': '203086', 'leuer, jon': '202720', 'liggins, deandre': '202732', 'lillard, damian': '203081', 'lin, jeremy': '202391', 'livingston, shaun': '2733', 'looney, kevon': '1626172', 'lopez, brook': '201572', 'lopez, robin': '201577', 'love, kevin': '201567', 'lowry, kyle': '200768', 'luwawu-cabarrot, timothe': '1627789', 'lydon, tyler': '1628399', 'lyles, trey': '1626168', 'mac, sheldon': '1627815', 'mack, shelvin': '202714', 'magette, josh': '203705', 'mahinmi, ian': '101133', 'maker, thon': '1627748', 'marjanovic, boban': '1626246', 'markkanen, lauri': '1628374', 'martin, jarell': '1626185', 'mason, frank': '1628412', 'mathiang, mangok': '1628493', 'matthews, wesley': '202083', 'mbah a moute, luc': '201601', 'mcadoo, james michael': '203949', 'mccaw, patrick': '1627775', 'mccollum, cj': '203468', 'mcconnell, t.j.': '204456', 'mccullough, chris': '1626191', 'mcdermott, doug': '203926', 'mcgee, javale': '201580', 'mcgruder, rodney': '203585', 'mckinnie, alfonzo': '1628035', 'mclemore, ben': '203463', 'mcroberts, josh': '201177', 'meeks, jodie': '201975', 'mejri, salah': '1626257', 'mickey, jordan': '1626175', 'middleton, khris': '203114', 'miles, cj': '101139', 'miller, darius': '203121', 'miller, malcolm': '1626259', 'mills, patty': '201988', 'millsap, paul': '200794', 'mirotic, nikola': '202703', 'mitchell, donovan': '1628378', 'monk, malik': '1628370', 'monroe, greg': '202328', 'montero, luis': '1626242', "moore, e'twaun": '202734', 'moreland, eric': '203961', 'morris, marcus': '202694', 'morris, markieff': '202693', 'morris, monte': '1628420', 'motley, johnathan': '1628405', 'mozgov, timofey': '202389', 'mudiay, emmanuel': '1626144', 'muhammad, shabazz': '203498', 'murray, dejounte': '1627749', 'murray, jamal': '1627750', 'muscala, mike': '203488', 'nene': '2403', 'nader, abdel': '1627846', 'nance jr., larry': '1626204', 'napier, shabazz': '203894', 'nelson, jameer': '2749', 'neto, raul': '203526', 'noah, joakim': '201149', 'noel, nerlens': '203457', 'nogueira, lucas': '203512', 'nowitzki, dirk': '1717', 'ntilikina, frank': '1628373', 'nurkic, jusuf': '203994', 'nwaba, david': '1628021', "o'bryant iii, johnny": '203948', "o'neale, royce": '1626220', "o'quinn, kyle": '203124', 'ojeleye, semi': '1628400', 'okafor, jahlil': '1626143', 'oladipo, victor': '203506', 'olynyk, kelly': '203482', 'onuaku, chinanu': '1627778', 'osman, cedi': '1626224', 'ouattara, yakuba': '1628473', 'oubre jr., kelly': '1626162', 'pachulia, zaza': '2585', 'paige, marcus': '1627779', 'papagiannis, georgios': '1627834', 'parker, jabari': '203953', 'parker, tony': '2225', 'parsons, chandler': '202718', 'patterson, patrick': '202335', 'patton, justin': '1628383', 'paul, brandon': '203464', 'paul, chris': '101108', 'payne, adreian': '203940', 'payne, cameron': '1626166', 'payton, elfrid': '203901', 'payton ii, gary': '1627780', 'perrantes, london': '1628506', 'peters, alec': '1628409', 'plumlee, mason': '203486', 'plumlee, miles': '203101', 'poeltl, jakob': '1627751', 'pondexter, quincy': '202347', 'porter jr., otto': '203490', 'portis, bobby': '1626171', 'porzingis, kristaps': '204001', 'powell, dwight': '203939', 'powell, norman': '1626181', 'poythress, alex': '1627816', 'prince, taurean': '1627752', 'pullen, jacob': '1626643', 'rabb, ivan': '1628397', 'randle, julius': '203944', 'randolph, zach': '2216', 'redick, jj': '200755', 'reed, davon': '1628432', 'reed, willie': '203186', 'richardson, josh': '1626196', 'richardson, malachi': '1627781', 'rivers, austin': '203085', 'roberson, andre': '203460', 'robinson, devin': '1628421', 'robinson iii, glenn': '203922', 'rondo, rajon': '200765', 'rose, derrick': '201565', 'ross, terrence': '203082', 'rozier, terry': '1626179', 'rubio, ricky': '201937', "russell, d'angelo": '1626156', 'sabonis, domantas': '1627734', 'sampson, jakarr': '203960', 'saric, dario': '203967', 'satoransky, tomas': '203107', 'schroder, dennis': '203471', 'scott, mike': '203118', 'sefolosha, thabo': '200757', 'selden, wayne': '1627782', 'sessions, ramon': '201196', 'shumpert, iman': '202697', 'siakam, pascal': '1627783', 'simmons, ben': '1627732', 'simmons, jonathon': '203613', 'simmons, kobi': '1628424', 'singler, kyle': '202713', 'smart, marcus': '203935', 'smith, ish': '202397', 'smith, jr': '2747', 'smith, jason': '201160', 'smith jr., dennis': '1628372', 'snell, tony': '203503', 'speights, marreese': '201578', 'stauskas, nik': '203917', 'stephenson, lance': '202362', 'stone, julyan': '202933', 'sumner, edmond': '1628410', 'swanigan, caleb': '1628403', 'tatum, jayson': '1628369', 'taylor, isaiah': '1627819', 'teague, jeff': '201952', 'teletovic, mirza': '203141', 'temple, garrett': '202066', 'teodosic, milos': '1628462', 'terry, jason': '1891', 'theis, daniel': '1628464', 'thomas, isaiah': '202738', 'thomas, lance': '202498', 'thompson, klay': '202691', 'thompson, tristan': '202684', 'thornwell, sindarius': '1628414', 'tolliver, anthony': '201229', 'towns, karl-anthony': '1626157', 'tucker, pj': '200782', 'turner, evan': '202323', 'turner, myles': '1626167', 'udoh, ekpe': '202327', 'ulis, tyler': '1627755', 'valanciunas, jonas': '202685', 'valentine, denzel': '1627756', 'vanvleet, fred': '1627832', 'vaughn, rashad': '1626173', 'vonleh, noah': '203943', 'vucevic, nikola': '202696', 'wade, dwyane': '2548', 'waiters, dion': '203079', 'walker, kemba': '202689', 'wall, john': '202322', 'walton jr., derrick': '1628476', 'warren, tj': '203933', 'west, david': '2561', 'westbrook, russell': '201566', 'white, derrick': '1628401', 'white, okaro': '1627855', 'whitehead, isaiah': '1627785', 'whiteside, hassan': '202355', 'wiggins, andrew': '203952', 'wilcox, cj': '203912', 'wiley, jacob': '1628451', 'wilkins, damien': '2863', 'williams, alan': '1626210', 'williams, c.j.': '203710', 'williams, lou': '101150', 'williams, marvin': '101107', 'williams, troy': '1627786', 'williams jr., matt': '1628475', 'wilson, d.j.': '1628391', 'wilson, jamil': '203966', 'winslow, justise': '1626159', 'withey, jeff': '203481', 'wolters, nate': '203489', 'wright, brandan': '201148', 'wright, delon': '1626153', 'yabusele, guerschon': '1627824', 'young, joe': '1626202', 'young, mike': '1628454', 'young, nick': '201156', 'young, thaddeus': '201152', 'zeller, cody': '203469', 'zeller, tyler': '203092', 'zhou qi': '1627753', 'zipser, paul': '1627835', 'zizic, ante': '1627790', 'zubac, ivica': '1627826'}
players_dict = {key.replace(',', ''):players_dict[key] for key in players_dict.keys()}

last_names= {key.split()[0]:key.split()[-1] for key in players_dict.keys()}
repeated_last_names = {item:[i for i in last_names[item]] for item in set(last_names.keys()) if list(last_names.keys()).count(item) > 1}

player = 'james'

print([item for item in players_dict if player == item.split()[0]])	


reddit = praw.Reddit(client_id='HHZ5FFVA72bOFA',
					 client_secret='d2vtaU2gMLhxZ9x6nfxFtWp-AS0',
					 user_agent= 'This is a test bot',
					 username='',
					 password='')

subreddit = reddit.subreddit('nba')
keyword = 'statsbot'	
sleep_time = None

# for submission in subreddit.stream.submissions():
# 	submission.comments.replace_more(limit=0)
# 	for comment in submission.comments.list():
# 		comment_content = comment.body.lower().split() #Comment contetn normalized
# 		if keyword in comment_content:

comment = 'james statsbot'	
comment_content = comment.lower().split()

if keyword in comment_content:
	player_last_name = comment_content[comment_content.index(keyword) - 1]	

if player_last_name in repeated_last_names.keys():
	player_full_name = player_last_name + ' ' +comment_content[comment_content.index(keyword) - 2]
	
	try:
		player_id = {key.split()[0]:players_dict[key] for key in players_dict.keys()}[player_full_name]
	except:
		print("There are more players with the same last name, please specify the first name and watch out for typos")
	
	
else:
	player_stats = {'MIN': '' , 'PTS': '', 'FG%': '', '3P%': '','FT%':'', 'REB':'' , 'AST':'' , 'STL':'' , 'BLK':'' ,'+/-': ''}
	player_id = {key.split()[0]:players_dict[key] for key in players_dict.keys()}[player_last_name]

	url = 'https://stats.nba.com/player/'+player_id+'/'
	browser = webdriver.Chrome()
	browser.get(url)
	browser.execute_script("window.scrollTo(0, document.body.scrollHeight);")	
	html = browser.page_source
	soup = BeautifulSoup(html, 'html.parser')
